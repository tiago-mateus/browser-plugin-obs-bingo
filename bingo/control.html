<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, minimum-scale=1.0, maximum-scale=1.0, user-scalable=0">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
  <title>Lower thirds control panel</title>
  <link rel="stylesheet" href="../common/css/control.css">
  <script src="../common/js/jquery.js"></script>

</head>

<body class="lower-thirds-panel panel">
  <div class="static-panel-top">
    <div class="winner-input">
      <input type="text" id="winner-name" placeholder="Nome do ganhador">
      <br>
      <button id="send-button">Enviar</button>
      <button id="button-clean">X</button>
    </div>
    <div id="bingo-container"></div>

  </div>

  <script>
    var bc = new BroadcastChannel('obs-lower-thirds-channel');
    var buttonPressTime = 0;
    var pressDuration = 0;
    var winnerData = {
          name: null,
          number: null,
        };
    
    function createBingoTable() {
      var table = document.createElement('table');
      table.classList.add('bingo-table');

      var tbody = document.createElement('tbody');
      for (var i = 1; i <= 15; i++) {
        var tr = document.createElement('tr');
        for (var j = 0; j < 5; j++) {
          var number = i + j * 15;
          var td = document.createElement('td');
          td.classList.add('bingo-cell');
          td.textContent = number;
          td.addEventListener('mousedown', startButtonPress);
          td.addEventListener('mouseup', endButtonPress);
          td.addEventListener('click', function_send.bind(null, number));
          tr.appendChild(td);
        }
        tbody.appendChild(tr);
      }
      table.appendChild(tbody);

      var bingoContainer = document.getElementById('bingo-container');
      bingoContainer.appendChild(table);

      // Adicionar evento de clique para o botão de envio
      var sendButton = document.getElementById('send-button');
      sendButton.addEventListener('click', sendWinnerName);

      var cleanButton = document.getElementById('button-clean');
      cleanButton.addEventListener('click', sendClean);
    }

    function startButtonPress() {
      buttonPressTime = new Date().getTime();
    }

    function endButtonPress() {
      var currentTime = new Date().getTime();
      pressDuration = Math.floor((currentTime - buttonPressTime) / 1000); // Duração em segundos

      console.log("O botão foi pressionado por " + pressDuration + " segundos.");


    }

    function function_send(numero) {
      const celulas = document.querySelectorAll(".bingo-cell");
      
      if (pressDuration >= 1) {
        winnerData.name = "X";
        winnerData.numero = numero;
        celulas.forEach((celula) => {
          if (parseInt(celula.textContent) === numero) {
            celula.classList.remove('red');
          }
        });
      } else {
        winnerData.name = null;
        winnerData.numero = numero;
        celulas.forEach(celula => {
          if (parseInt(celula.textContent) === numero) {
            celula.classList.add("red");
          }
        });
      }
      
      bc.postMessage(winnerData);

    };

    function sendWinnerName() {
      var winnerNameInput = document.getElementById('winner-name');
      var winnerName = winnerNameInput.value;
      var numero = 0; // Defina o número vencedor aqui

      const celulas = document.querySelectorAll('.bingo-cell');

      celulas.forEach((celula) => {
        if (parseInt(celula.textContent) === numero) {
          celula.classList.add('red');
        }
      });

      winnerData.name = winnerName;
      winnerData.numero = null;

      bc.postMessage(winnerData); /* Enviar os dados do vencedor */
    }

    function sendClean() {
      winnerData.name = "zerar"
      winnerData.numero = "zerar"
      
      const celulas = document.querySelectorAll('.bingo-cell');
      celulas.forEach((celula) => {
        celula.classList.remove('red');
      });
      bc.postMessage(winnerData); /* Enviar os dados do vencedor */
    }

    createBingoTable();
  </script>
</body>

</html>